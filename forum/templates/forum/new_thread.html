{% extends "tickets/barbu_base.html" %}
{% load static %}

{% block title %}Nuevo Hilo - {{ section.name }}{% endblock %}

{% block full_content %}
<div class="container-fluid innercontent">
    <div class="container">
        <div class="row">
            <div class="col-12">
<style>
/* vBulletin 2005 Style with site colors */
.vbulletin-forum {
    font-family: "Inter", sans-serif;
    font-size: 16px;
    color: #1e1e1e;
}

.vbulletin-breadcrumb {
    background: #f8f7f4;
    padding: 8px;
    border: 1px solid #b2b2b2;
    margin-bottom: 10px;
    font-size: 14px;
}

.vbulletin-breadcrumb a {
    color: #289e6d;
    text-decoration: none;
}

.vbulletin-breadcrumb a:hover {
    text-decoration: underline;
}

.vbulletin-section-info {
    background: #f8f7f4;
    padding: 8px;
    border: 1px solid #b2b2b2;
    margin-bottom: 10px;
    font-size: 14px;
}

.vbulletin-form-container {
    background: #FFFFFF;
    border: 1px solid #b2b2b2;
    margin-bottom: 20px;
}

.vbulletin-form-header {
    background: #289e6d;
    color: #FFFFFF;
    padding: 8px;
    font-weight: bold;
    border-bottom: 1px solid #289e6d;
}

.vbulletin-form-body {
    padding: 15px;
}

.vbulletin-form-group {
    margin-bottom: 15px;
}

.vbulletin-form-label {
    font-weight: bold;
    color: #1e1e1e;
    margin-bottom: 5px;
    display: block;
}

.vbulletin-form-input {
    width: 100%;
    padding: 8px;
    border: 1px solid #b2b2b2;
    font-family: "Inter", sans-serif;
    font-size: 16px;
}

.vbulletin-form-textarea {
    width: 100%;
    padding: 8px;
    border: 1px solid #b2b2b2;
    font-family: "Inter", sans-serif;
    font-size: 16px;
    min-height: 200px;
    resize: vertical;
}

.vbulletin-form-actions {
    background: #f8f7f4;
    padding: 10px;
    border-top: 1px solid #b2b2b2;
    text-align: right;
}

.vbulletin-btn {
    padding: 6px 12px;
    border: 1px solid #b2b2b2;
    background: #f8f7f4;
    color: #1e1e1e;
    text-decoration: none;
    font-size: 14px;
    margin-left: 5px;
    cursor: pointer;
}

.vbulletin-btn:hover {
    background: #f0f0f0;
}

.vbulletin-btn-primary {
    background: #289e6d;
    color: #FFFFFF;
    border-color: #289e6d;
}

.vbulletin-btn-primary:hover {
    background: #33b37d;
    border-color: #33b37d;
}

</style>

<div class="vbulletin-forum">
    <div class="vbulletin-breadcrumb">
        <a href="{% url 'forum:forum_index' %}">Foro</a> &raquo; 
        <a href="{% url 'forum:section_detail' section.id %}">{{ section.name }}</a> &raquo; Nuevo Hilo
                    </div>
    
    <div class="vbulletin-section-info">
        <strong>Sección:</strong> {{ section.name }} - {{ section.description }}
                </div>
    
    <div class="vbulletin-form-container">
        <div class="vbulletin-form-header">
            Crear Nuevo Hilo
                    </div>
        <div class="vbulletin-form-body">
                    
                    <form method="post">
                        {% csrf_token %}
                        
                <div class="vbulletin-form-group">
                    <label for="{{ form.title.id_for_label }}" class="vbulletin-form-label">
                        Título del Hilo
                            </label>
                    <input type="text" name="title" id="{{ form.title.id_for_label }}" class="vbulletin-form-input" value="{{ form.title.value|default:'' }}" required>
                            {% if form.title.errors %}
                        <div style="color: #CC0000; font-size: 10px; margin-top: 2px;">
                                    {% for error in form.title.errors %}
                                {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                <div class="vbulletin-form-group">
                    <label for="content" class="vbulletin-form-label">
                        Mensaje Inicial
                            </label>
                            
                            
                        <!-- Contenedor para Quill.js -->
                        <div id="editor" style="height: 300px; border: 1px solid #b2b2b2; border-radius: 4px;"></div>
                        <!-- Textarea oculto para el formulario -->
                        <textarea name="content" id="content" style="display: none;"></textarea>
                        <div style="font-size: 10px; color: #666666; margin-top: 5px;">
                                Este será el primer mensaje de tu hilo. Puedes editarlo después si es necesario.
                            </div>
                        </div>
                        
                        <div class="vbulletin-form-actions">
                            <a href="{% url 'forum:section_detail' section.id %}" class="vbulletin-btn">
                                Cancelar
                            </a>
                            <button type="submit" class="vbulletin-btn vbulletin-btn-primary">
                                Crear Hilo
                            </button>
                        </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Quill.js CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<!-- Quill.js JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

<script>
// Initialize Quill.js
const quill = new Quill('#editor', {
    theme: 'snow',
    placeholder: 'Escribe el contenido de tu mensaje inicial aquí...',
    modules: {
        toolbar: [
            [{ 'header': [1, 2, 3, false] }],
            ['bold', 'italic', 'underline', 'strike'],
            [{ 'color': [] }, { 'background': [] }],
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            [{ 'align': [] }],
            ['link', 'blockquote', 'code-block'],
            ['clean']
        ]
    }
});

// Sync content to hidden textarea
quill.on('text-change', function() {
    const content = quill.root.innerHTML;
    document.querySelector('#content').value = content;
});

console.log('Quill.js cargado correctamente');

// Handle form submission
document.querySelector('form').addEventListener('submit', function(e) {
    // Ensure content is synced before submission
    const content = quill.root.innerHTML;
    document.querySelector('#content').value = content;
});
</script>
            </div>
        </div>
    </div>
</div>
{% endblock full_content %}
